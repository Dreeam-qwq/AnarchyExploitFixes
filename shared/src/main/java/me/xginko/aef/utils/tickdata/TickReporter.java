package me.xginko.aef.utils.tickdata;

import org.bukkit.Server;
import org.bukkit.plugin.java.JavaPlugin;

import java.time.Duration;

public interface TickReporter {

    double getGlobalTPS();
    double getTPS();
    double getGlobalMSPT();
    double getMSPT();

    static TickReporter create(JavaPlugin plugin, Duration cacheDuration) {
        try {
            Class.forName("io.papermc.paper.threadedregions.RegionizedServer");
            Class.forName("io.papermc.paper.threadedregions.ThreadedRegionizer");
            Class.forName("io.papermc.paper.threadedregions.TickRegionScheduler");
            Class.forName("io.papermc.paper.threadedregions.TickRegions");
            return new FoliaTickReporter(cacheDuration);
        } catch (ClassNotFoundException ignored) {}

        try {
            Server.class.getMethod("getAverageTickTime");
            return new PaperTickReporter(plugin, cacheDuration);
        } catch (NoSuchMethodException e) {
            return new LegacyTickReporter(plugin, cacheDuration);
        }
    }
}