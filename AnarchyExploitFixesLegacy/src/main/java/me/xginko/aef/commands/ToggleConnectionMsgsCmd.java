package me.xginko.aef.commands;

import cloud.commandframework.annotations.CommandDescription;
import cloud.commandframework.annotations.CommandMethod;
import cloud.commandframework.annotations.CommandPermission;
import me.xginko.aef.AnarchyExploitFixes;
import org.bukkit.ChatColor;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;

public class ToggleConnectionMsgsCmd implements AEFCommand {
    @Override
    public boolean shouldRegister() {
        return AnarchyExploitFixes.config().cmd_toggleConMsgs_enabled;
    }

    @CommandMethod("toggleconnectionmsgs")
    @CommandPermission("aef.cmd.toggleconnectionmsgs")
    @CommandDescription("Toggle connection messages on or off")
    public void onConMsgToggle(final CommandSender sender) {
        if (!(sender instanceof Player)) {
            sender.sendMessage(ChatColor.RED+"Only players can execute this command.");
            return;
        }

        final Player player = (Player) sender;

        AnarchyExploitFixes.getDatastore().getJoinLeaveEnabled(player.getUniqueId()).thenAccept(enabled -> {
            if (enabled) {
                AnarchyExploitFixes.getDatastore().setJoinLeaveEnabled(player.getUniqueId(), false)
                        .thenRun(() -> sender.sendMessage(AnarchyExploitFixes.getLang(player.getLocale()).misc_disabledConnectionMsgs));
            } else {
                AnarchyExploitFixes.getDatastore().setJoinLeaveEnabled(player.getUniqueId(), true)
                        .thenRun(() -> sender.sendMessage(AnarchyExploitFixes.getLang(player.getLocale()).misc_enabledConnectionMsgs));
            }
        });
    }
}