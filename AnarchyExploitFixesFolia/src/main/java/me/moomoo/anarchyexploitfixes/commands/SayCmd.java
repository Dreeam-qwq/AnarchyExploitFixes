package me.moomoo.anarchyexploitfixes.commands;

import cloud.commandframework.annotations.Argument;
import cloud.commandframework.annotations.CommandDescription;
import cloud.commandframework.annotations.CommandMethod;
import cloud.commandframework.annotations.CommandPermission;
import cloud.commandframework.annotations.specifier.Greedy;
import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import net.kyori.adventure.text.TextReplacementConfig;
import net.kyori.adventure.text.minimessage.MiniMessage;
import org.apache.commons.lang3.StringUtils;
import org.bukkit.command.CommandSender;

public class SayCmd implements AEFCommand {
    @Override
    public boolean shouldRegister() {
        return AnarchyExploitFixes.getConfiguration().cmd_say_enabled;
    }

    @CommandMethod("say <message>")
    @CommandPermission("aef.cmd.say")
    @CommandDescription("Broadcast a message to all players")
    public void onSay(
            final CommandSender sender,
            final @Argument(value = "message", description = "message you want to broadcast") @Greedy String[] message
    ) {
        AnarchyExploitFixes.getInstance().getServer().broadcast(AnarchyExploitFixes.getConfiguration().cmd_say_format
                .replaceText(TextReplacementConfig.builder()
                        .matchLiteral("%message%")
                        .replacement(MiniMessage.miniMessage().deserialize(StringUtils.join(message, " ")))
                        .build())
        );
    }
}