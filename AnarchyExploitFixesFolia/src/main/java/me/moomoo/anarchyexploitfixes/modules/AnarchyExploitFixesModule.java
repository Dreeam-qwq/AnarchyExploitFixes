package me.moomoo.anarchyexploitfixes.modules;

import com.comphenix.protocol.ProtocolLibrary;
import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import me.moomoo.anarchyexploitfixes.modules.bedrock.*;
import me.moomoo.anarchyexploitfixes.modules.chat.*;
import me.moomoo.anarchyexploitfixes.modules.chat.commandwhitelist.CommandWhitelist;
import me.moomoo.anarchyexploitfixes.modules.chunklimits.*;
import me.moomoo.anarchyexploitfixes.modules.combat.*;
import me.moomoo.anarchyexploitfixes.modules.dupepreventions.*;
import me.moomoo.anarchyexploitfixes.modules.elytra.*;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.PeriodicallyRemoveIllegalBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.RemoveIllegalBlocksOnChunkload;
import me.moomoo.anarchyexploitfixes.modules.illegals.blocks.RemoveUnnaturalSpawners;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RemoveSpecificItemNames;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RevertOverstacked;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.RevertUnbreakables;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.bannedblocks.BanSpecificBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.bannedblocks.PreventPlacingBannedBlocks;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.HigherEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.InapplicableEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.IncompatibleEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.enchantments.SpecificHigherEnchants;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.nbt.NBTStorageItems;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.playerheads.BanPlayerHeads;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.playerheads.PreventPlacingPlayerHeads;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.spawneggs.PreventUsingSpawnEggs;
import me.moomoo.anarchyexploitfixes.modules.illegals.items.spawneggs.RemoveSpawnEggs;
import me.moomoo.anarchyexploitfixes.modules.lagpreventions.*;
import me.moomoo.anarchyexploitfixes.modules.lagpreventions.lowtpsphysics.*;
import me.moomoo.anarchyexploitfixes.modules.misc.*;
import me.moomoo.anarchyexploitfixes.modules.options1b1t.DistanceAwayToTP;
import me.moomoo.anarchyexploitfixes.modules.options1b1t.HurtCommands;
import me.moomoo.anarchyexploitfixes.modules.options1b1t.PlaceBedrock;
import me.moomoo.anarchyexploitfixes.modules.options1b1t.SlowDupe;
import me.moomoo.anarchyexploitfixes.modules.patches.*;
import me.moomoo.anarchyexploitfixes.modules.preventions.BedTrap;
import me.moomoo.anarchyexploitfixes.modules.preventions.NetherRoof;
import me.moomoo.anarchyexploitfixes.modules.preventions.PreventNonSurvival;
import me.moomoo.anarchyexploitfixes.modules.preventions.PreventOppedPlayers;
import me.moomoo.anarchyexploitfixes.modules.preventions.portals.*;
import me.moomoo.anarchyexploitfixes.modules.preventions.withers.*;
import me.moomoo.anarchyexploitfixes.modules.protocollib.boatfly.AntiBoatFlyModule;

import java.util.HashSet;

public interface AnarchyExploitFixesModule {

    String name();
    String category();
    void enable();
    boolean shouldEnable();
    void disable();

    HashSet<AnarchyExploitFixesModule> modules = new HashSet<>();

    static void reloadModules() {
        modules.forEach(AnarchyExploitFixesModule::disable);
        modules.clear();

        /*
            Bedrock
        */
        modules.add(new FillNetherCeilingOnChunkload());
        modules.add(new FillNetherFloorOnChunkload());
        modules.add(new FillOverworldFloorOnChunkload());
        modules.add(new PeriodicallyFillNetherCeiling());
        modules.add(new PeriodicallyFillNetherFloor());
        modules.add(new PeriodicallyFillOverworldFloor());
        modules.add(new PreventGoingBelowBedrockFloor());
        modules.add(new PistonExplodeBedrockRemoval());
        modules.add(new PistonPlaceWhileRetractBedrockRemoval());
        /*
            Chat
        */
        modules.add(new BannedRegex());
        modules.add(new BannedWords());
        modules.add(new CharacterLimit());
        modules.add(new CommandWhitelist());
        modules.add(new PreventChatSpam());
        modules.add(new PreventCommandSpam());
        modules.add(new PreventLinks());
        modules.add(new PreventLinkSpam());
        modules.add(new PreventPluginScanning());
        modules.add(new RemoveSpecificCharacters());
        /*
            Chunk Limits
        */
        modules.add(new BlockLimit());
        modules.add(new CustomEntityLimit());
        modules.add(new ExpBottleLimit());
        modules.add(new FallingBlockLimit());
        modules.add(new MinecartLimit());
        modules.add(new VehicleLimit());
        modules.add(new NonLivingEntityLimit());
        modules.add(new DroppedItemLimit());
        modules.add(new VillagerLimit());
        /*
            Dupe Preventions
        */
        modules.add(new ChestedEntitiesInPortals());
        modules.add(new ChestsOnEntities());
        modules.add(new CloseEntitiyInventoriesOnLogout());
        modules.add(new CloseEntityInventoryOnChunkUnload());
        modules.add(new EndPortalDupe());
        /*
            Elytra
        */
        modules.add(new ElytraAtSpawn());
        modules.add(new ElytraGlobal());
        modules.add(new ElytraOnCeiling());
        modules.add(new NewChunksListener());
        modules.add(new ElytraPacketFly());
        /*
            Illegals
        */
        // Blocks
        modules.add(new RemoveIllegalBlocksOnChunkload());
        modules.add(new PeriodicallyRemoveIllegalBlocks());
        modules.add(new RemoveUnnaturalSpawners());
        // Items
        modules.add(new RemoveSpecificItemNames());
        modules.add(new RevertOverstacked());
        modules.add(new RevertUnbreakables());
        // Banned Blocks
        modules.add(new BanSpecificBlocks());
        modules.add(new PreventPlacingBannedBlocks());
        // Enchantments
        modules.add(new IncompatibleEnchants());
        modules.add(new HigherEnchants());
        modules.add(new SpecificHigherEnchants());
        modules.add(new InapplicableEnchants());
        // NBT Items
        modules.add(new NBTStorageItems());
        // Player head items
        modules.add(new BanPlayerHeads());
        modules.add(new PreventPlacingPlayerHeads());
        // Spawn Eggs
        modules.add(new PreventUsingSpawnEggs());
        modules.add(new RemoveSpawnEggs());
        /*
            Lag Preventions
        */
        modules.add(new LeverSpam());
        modules.add(new SnowballExploit());
        modules.add(new FallingBlockStasis());
        modules.add(new LiquidUpdateLag());
        modules.add(new PathfindingLimits());
        modules.add(new Explosions());
        modules.add(new BlockPhysics());
        modules.add(new LiquidSpread());
        modules.add(new BlockMelting());
        modules.add(new Redstone());
        modules.add(new Noteblocks());
        modules.add(new FireSpread());
        modules.add(new GrassSpread());
        modules.add(new LeaveDecay());
        /*
            Misc
        */
        modules.add(new FirstJoinMessages());
        modules.add(new JoinLeaveMessages());
        modules.add(new MaskKickMessages());
        modules.add(new PreventSpamKick());
        modules.add(new KickPhraseListener());
        /*
            1b1t Options
        */
        modules.add(new DistanceAwayToTP());
        modules.add(new HurtCommands());
        modules.add(new PlaceBedrock());
        modules.add(new SlowDupe());
        /*
            Patches
        */
        modules.add(new BookBan());
        modules.add(new Burrow());
        modules.add(new CommandSign());
        modules.add(new EndPortalDestruction());
        modules.add(new GodMode());
        modules.add(new TeleportCoordExploit());
        modules.add(new BeehiveCoordinates());
        /*
            Combat
        */
        modules.add(new BowBomb());
        modules.add(new CrystalAuraDelay());
        modules.add(new AnchorAuraDelay());
        modules.add(new BedAuraDelay());
        modules.add(new PistonAuraDelay());
        modules.add(new CrystalAuraHotbarSwitchDelay());
        /*
            Preventions
        */
        modules.add(new BedTrap());
        modules.add(new NetherRoof());
        modules.add(new PreventNonSurvival());
        modules.add(new PreventOppedPlayers());
        // Portals
        modules.add(new PreventAllEntitiesInPortals());
        modules.add(new PreventDroppedItemsInPortals());
        modules.add(new PreventFireworksInPortals());
        modules.add(new PreventPortalTraps());
        modules.add(new PreventProjectilesInPortals());
        modules.add(new PreventCustomEntities());
        // Withers
        modules.add(new DisableWitherSkulls());
        modules.add(new RateLimitWitherSkulls());
        modules.add(new RemoveAllSkullsPeriodically());
        modules.add(new RemoveSkullsAfterXTicks());
        modules.add(new RemoveSkullsOnChunkload());
        modules.add(new RemoveSkullsOnChunkunload());
        modules.add(new WitherSpawningAtSpawn());
        /*
            ProtocolLib
        */
        boolean protocolLibIsInstalled = unregisterPacketListeners(AnarchyExploitFixes.getInstance());

        modules.add(new AntiBoatFlyModule());

        if (!AnarchyExploitFixes.getConfiguration().protocolLib_IsDisabled && !protocolLibIsInstalled) {
            AnarchyExploitFixes.getLog().severe("Could not find ProtocolLib. Some packet exploits cannot be patched without it.");
            AnarchyExploitFixes.getLog().severe("Download at: https://www.spigotmc.org/resources/protocollib.1997/");
        }

        for (AnarchyExploitFixesModule module : modules) {
            if (module.shouldEnable()) module.enable();
        }
    }

    static boolean unregisterPacketListeners(AnarchyExploitFixes plugin) {
        boolean protocolLibIsInstalled = AnarchyExploitFixes.isProtocolLibInstalled();
        if (protocolLibIsInstalled) ProtocolLibrary.getProtocolManager().removePacketListeners(plugin);
        return protocolLibIsInstalled;
    }
}
